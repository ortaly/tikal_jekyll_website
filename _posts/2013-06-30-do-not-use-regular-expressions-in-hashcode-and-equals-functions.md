---
layout: post
title: Do not use regular expressions in hashcode and equals functions
created: 1372617137
author: oren.kleks
permalink: do-not-use-regular-expressions-in-hashcode-and-equals-functions
tags:
- JAVA
- Java Performance Regular Expressions hashcode equals
---
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;"><span style="background-color: transparent; vertical-align: baseline;">The functions </span><a href="http://stackoverflow.com/questions/27581/overriding-equals-and-hashcode-in-java" style="font-family: Arial, Verdana, sans-serif; font-size: 12px; line-height: 13px; text-decoration: none;"><span style="font-size: 15px; font-family: Arial; color: rgb(17, 85, 204); background-color: transparent; text-decoration: underline; vertical-align: baseline;">hashcode and equals </span></a><span style="background-color: transparent; vertical-align: baseline;">are old topic in the Java Community. </span>In this post I want to discuss performance issue that I encountered with one of my clients regarding these functions. </span></span></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">The project I used had a dilema, there were legacy ID strings and new ID strings. In order to make equals and hashcode effective, the ID string should be processed with regular expressions</span></span></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean equals(Object obj) {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getId().equals(obj);</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public int hashCode() {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getId().hashCode();</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public String getId() {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &nbsp;super.getIdVal().replace(REPLACE_PREFIX, &quot;(&quot;).replace(REPLACE_POSTFIX,&quot;)&quot;).replace(&quot; &quot;,&quot;&quot;);</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">This is of course a disaster.The functions equals and hascode are called frequently, and they have tremendous impact on performance.</span></span></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">Changing the code to </span></span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public boolean equals(Object obj) {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getId().equals(obj);</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public int hashCode() {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getId().hashCode();</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public String getId() {</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">if (cacheStr == null)</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cacheStr = super.getIdVal().replace(REPLACE_PREFIX, &quot;(&quot;).replace(REPLACE_POSTFIX,&quot;)&quot;).replace(&quot; &quot;,&quot;&quot;);</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">return cacheStr;</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><sub><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></sub></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">This change improved performance by 50% !!!!!</span></span></p>
<p>&nbsp;</p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">In the sample code performance were improved from 14 secinds to 9 seconds. </span></span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">In my customer product, startup time improved from 10 minutes to 4!!!</span></span></p>
<p dir="ltr" style="line-height:1.15;margin-top:0pt;margin-bottom:0pt;"><span id="docs-internal-guid-6d266f09-9656-2386-eb42-b301854d3b36"><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">Sample code is </span><a href="https://docs.google.com/file/d/0B1oMZQt3rUSNdjgzOVd1VnVuVU0/edit?usp=sharing" style="text-decoration:none;"><span style="font-size: 15px; font-family: Arial; color: rgb(17, 85, 204); background-color: transparent; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">available</span></a><span style="font-size: 15px; font-family: Arial; color: rgb(0, 0, 0); background-color: transparent; vertical-align: baseline; white-space: pre-wrap;">.</span></span></p>
<p><br />
	&nbsp;</p>
