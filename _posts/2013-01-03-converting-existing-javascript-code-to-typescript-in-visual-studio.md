---
layout: post
title: Converting existing JavaScript code to TypeScript in Visual Studio
created: 1357198860
author: igorz
permalink: /net/converting-existing-javascript-code-typescript-visual-studio
tags:
- .NET
- .Net Open Source
---
The best way to learn new technology is to start using it with real project. I have such - <a href="http://www.izwebfilemanager.com/">IZWebFileManager</a>. It  was written when ASP.NET MVC wasn't event in mind and Web Forms was only framework for web application in .NET.  IZWebFileManager is an ASP.NET Server Control and has about 1300 lines of JavaScript code.<br /><br />The challenge is to convert all existing JavaScript code in the project to TypeScript. The result of this effort you can find here:<a href="https://github.com/manishma/IZWebFileManager/tree/typescript"> https://github.com/manishma/IZWebFileManager/tree/typescript</a><br /><br />It this post I'll tell you about steps I went through.<br /><br /><br /><a name='more'></a><br /><h2>1. Adding support of TypeScript to the project</h2>I have installed TypeScript plugin for VisualStudo and customized the project file as I described in my previous post "<a href="http://igorzelmanovich.blogspot.co.il/2013/01/using-typescript-with-existing-project.html">Using TypeScript with an existing ASP.NET project</a>"<br /><br /><h2>2. Changing file extensions from *.js to *.ts</h2><div>This step is a bit tricky. All JavaScript files in the project are build as embedded resource. From other side, TypeScript files have it's own build action "TypeScriptCompile". I have to maintain a configuration, which allows to keep proper build action for both files. It is much easy to do by editing *.proj file directly.</div><div><br /></div><div>All java script files in project are listed in this way:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-XtdImTo6Xec/UOUczKYz55I/AAAAAAAAUBg/3WbQRQnA46s/s1600/2013-01-03_07h50_25.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-XtdImTo6Xec/UOUczKYz55I/AAAAAAAAUBg/3WbQRQnA46s/s1600/2013-01-03_07h50_25.png" /></a></div><div><br /></div><div>I changed it to</div><div><br /></div><div> <a href="http://3.bp.blogspot.com/-fHCTFPl-p1Q/UOUdgIRXA6I/AAAAAAAAUBw/MWRus7kePD4/s1600/2013-01-03_07h54_44.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-fHCTFPl-p1Q/UOUdgIRXA6I/AAAAAAAAUBw/MWRus7kePD4/s1600/2013-01-03_07h54_44.png" /></a></div><div><br /></div><div>And then changed extension of *.js files to *.ts. </div><div>NOTE:  Don't use Visual Studio for changing file extensions, cause it makes changes in project file. Do it directly in file manager.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ODmpUbW-dno/UOUfCgg_K4I/AAAAAAAAUCA/m5baT6lN_R0/s1600/2013-01-03_08h01_10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ODmpUbW-dno/UOUfCgg_K4I/AAAAAAAAUCA/m5baT6lN_R0/s1600/2013-01-03_08h01_10.png" /></a></div><div><br /></div><div><br /></div><div>After opening/reloading project in Visual Studio I got this:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-bF-A5xbmdq0/UOUfx9DLmEI/AAAAAAAAUCI/64RB5xlT0C4/s1600/2013-01-03_08h04_13.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-bF-A5xbmdq0/UOUfx9DLmEI/AAAAAAAAUCI/64RB5xlT0C4/s1600/2013-01-03_08h04_13.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>FileManagerController.js is not found, cause it does not exit yet. I have to build the project to get all *.js files  be produced.  But building the project at this step results an error:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-nTtllO9Opbw/UOUhSgdUpXI/AAAAAAAAUCY/WxMXugotk-Q/s1600/2013-01-03_08h10_37.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="154" src="http://1.bp.blogspot.com/-nTtllO9Opbw/UOUhSgdUpXI/AAAAAAAAUCY/WxMXugotk-Q/s640/2013-01-03_08h10_37.png" width="640" /></a></div><div>Don't get panic! It is normal situation. The converted JavaScript has a lot of errors and unrecognized references. You see it immediately when you open *.ts file:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-GFV5ixzADWQ/UOUijyKxi9I/AAAAAAAAUCo/vy31342lR7Y/s1600/2013-01-03_08h15_37.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://4.bp.blogspot.com/-GFV5ixzADWQ/UOUijyKxi9I/AAAAAAAAUCo/vy31342lR7Y/s640/2013-01-03_08h15_37.png" width="606" /></a></div><div><br /></div><div><br /></div><h2>3. Fixing errors</h2><div>The one of benefits of TypeScript is error detection. It is not easy to make silly mistake with TypeScript.</div><div><br /></div><div>One of most common errors in my code was not declaring loop counter variable in local scope:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-L-acMuSLEmc/UOUlSUiKKII/AAAAAAAAUC4/-MHH5mL8XDM/s1600/2013-01-03_08h27_39.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-L-acMuSLEmc/UOUlSUiKKII/AAAAAAAAUC4/-MHH5mL8XDM/s1600/2013-01-03_08h27_39.png" /></a></div><div><br /></div><div>It was easy to fix:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ySYtNkmixuo/UOUl0loTjQI/AAAAAAAAUDA/vLUTABpqsgI/s1600/2013-01-03_08h29_50.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ySYtNkmixuo/UOUl0loTjQI/AAAAAAAAUDA/vLUTABpqsgI/s1600/2013-01-03_08h29_50.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><h2>4. Reference to external JavaScript API</h2><div>TypeScript compiler requires all functions and variables to be declared. If you use a function, which is defined somewhere out of current *.ts file, you have to declare it's signature (it is very similar to C programming)</div><div><br /></div><div>For example, I use WebFileManager_DoCallback function, which is defined inline in HTML file TypeScript compiler gives me an error:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-x4Xu4mgAxRw/UOUwQ2ZIUKI/AAAAAAAAUDQ/IMe9UgE0bZ8/s1600/2013-01-03_09h13_07.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-x4Xu4mgAxRw/UOUwQ2ZIUKI/AAAAAAAAUDQ/IMe9UgE0bZ8/s1600/2013-01-03_09h13_07.png" /></a></div><div><br /></div><div>Following line in top of the file satisfies compiler:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-GuVuYxpOYxU/UOUxMwpZ47I/AAAAAAAAUDY/eu1f6O_3DhU/s1600/2013-01-03_09h18_40.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="32" src="http://1.bp.blogspot.com/-GuVuYxpOYxU/UOUxMwpZ47I/AAAAAAAAUDY/eu1f6O_3DhU/s640/2013-01-03_09h18_40.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>If you want to reuse such declarations, then you may extract all definitions to the *.d.ts file and reference to it from *.ts file. I did it for ASP.NET WebForms client side API. </div><div><br /></div><div>Bellow is a content of WebForm.d.ts file:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-s6aF5UTOWE8/UOUys6Sbv9I/AAAAAAAAUDw/r1lOWiLeBbw/s1600/2013-01-03_09h24_50.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-s6aF5UTOWE8/UOUys6Sbv9I/AAAAAAAAUDw/r1lOWiLeBbw/s1600/2013-01-03_09h24_50.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>And the reference to it:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-sKRuCLitQwc/UOUzMsXA2FI/AAAAAAAAUD4/WPYjwt7zMls/s1600/2013-01-03_09h26_49.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-sKRuCLitQwc/UOUzMsXA2FI/AAAAAAAAUD4/WPYjwt7zMls/s1600/2013-01-03_09h26_49.png" /></a></div><div><br /></div><h2>5. Building the project</h2><div>After solving all TypeScript compilation errors, I was able to build the project. As result, I got all *.js files be created.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-siC_5VYhLdc/UOU0E0pL2AI/AAAAAAAAUEA/6A3_-xuH7n8/s1600/2013-01-03_09h30_44.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-siC_5VYhLdc/UOU0E0pL2AI/AAAAAAAAUEA/6A3_-xuH7n8/s1600/2013-01-03_09h30_44.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>Now I am ready to continue developing of IZWebFileManager with power of TypeScript.</div>
