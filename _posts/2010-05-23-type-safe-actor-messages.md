---
layout: post
title: Type safe actor messages
created: 1274601030
author: ittayd
permalink: /java/type-safe-actor-messages
tags:
- JAVA
- scala actors
- Scala
---
<p>&nbsp;One of my pain points with the actors library is how to handle replies to a message. The library provides the methods &lsquo;!?&rsquo; and &lsquo;!!&rsquo;, but without type safety. Client code needs to cast the reply to the expected type:</p>
<p>&nbsp;</p>
<p class="MsoNormal"><span style="font-size:10.5pt;
line-height:115%;font-family:&quot;Courier New&quot;;color:#F78811"><span style="mso-spacerun:yes">&nbsp;</span>(</span><span style="font-size:10.5pt;line-height:115%;font-family:&quot;Courier New&quot;;color:#000020">actor</span><span class="apple-converted-space"><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000020">&nbsp;</span></span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:navy">!?</span><span class="apple-converted-space"><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000020">&nbsp;</span></span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000020">MyMessage</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">())</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000020">.</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:black">asInstanceOf</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000020">Boolean</span><span style="font-size:10.5pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">]<o:p></o:p></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Also, it is hard to know what type the result should be. Even if all the messages an actor expects are located in one file, there&rsquo;s no indication (other than comments) about what the reply type is.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Another issue is that if an actor does reply to a message, but the sender does not react to it, then it is kept in the sender&rsquo;s mailbox and may interfere with future reacts or simply take up memory</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">To fix this, first, define a trait that tags the reply of an actor to a message:</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><b><span style="font-family:
&quot;Courier New&quot;;color:#000066">trait</span></b><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Reply</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">]</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">{</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span>result</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">a</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">)</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">a.</span><span style="font-family:&quot;Courier New&quot;;color:black">asInstanceOf</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">]</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
</span><span style="font-family:&quot;Courier New&quot;;
color:#F78811">}<o:p></o:p></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">And use it:</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><b><span style="font-size:10.0pt;
line-height:115%;font-family:&quot;Courier New&quot;;color:#000066">case</span></b><span class="apple-converted-space"><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">class</span></b><span class="apple-converted-space"><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">MyMessage</span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">()</span><span class="apple-converted-space"><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">extends</span></b><span class="apple-converted-space"><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">Reply</span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#000066">Boolean</span><span style="font-size:10.0pt;line-height:115%;
font-family:&quot;Courier New&quot;;color:#F78811">]<o:p></o:p></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="font-size:10.0pt;line-height:115%">Now we can pimp the actors library and add methods that use this information. <o:p></o:p></span></p>
<p class="MsoListParagraphCxSpFirst rteindent1" style="text-indent:-18.0pt;mso-list:l0 level1 lfo1"><span style="font-size:10.0pt;line-height:115%;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol"><span style="mso-list:Ignore">&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10.0pt;line-height:115%">!?! is like !?, but with the correct return type<o:p></o:p></span></p>
<p class="MsoListParagraphCxSpLast rteindent1" style="text-indent:-18.0pt;mso-list:l0 level1 lfo1"><span style="font-size:10.0pt;line-height:115%;font-family:Symbol;mso-fareast-font-family:
Symbol;mso-bidi-font-family:Symbol"><span style="mso-list:Ignore">&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-size:10.0pt;line-height:115%">!!! is like ! but always consumes the reply<o:p></o:p></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><b><span style="font-family:
&quot;Courier New&quot;;color:#000066">class</span></b><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">RichActor</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">self</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Actor</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">)</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">{</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">!?!</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Manifest</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">](</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Reply</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">])</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; msg.</span><span style="font-family:&quot;Courier New&quot;;color:black">result</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">((</span><span style="font-family:&quot;Courier New&quot;;color:#000066">self</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">!?</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">))</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">!!!</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Manifest</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">](</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Reply</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">])</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">if</span></b><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">manifest</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">T</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">]</span><span style="font-family:&quot;Courier New&quot;;color:#000066">.</span><span style="font-family:&quot;Courier New&quot;;color:black">erasure</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">==</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Void.</span><span style="font-family:&quot;Courier New&quot;;color:black">TYPE</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">)</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">self</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">!</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">else</span></b><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">{</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>val</b><span class="apple-converted-space">&nbsp;</span>out<span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">new</span></b><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">OutputChannel</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">]</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">{</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span>receiver<span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">null</span></b><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span>forward</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">)</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">null</span></b><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span>send</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any, replyTo</span><span style="font-family:
&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">OutputChannel</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">[</span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">])</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">null</span></b><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span><b>def</b><span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">!</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg</span><span style="font-family:&quot;Courier New&quot;;color:navy">:</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#000066">Any</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">)</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:navy">=</span><span class="apple-converted-space"><span style="font-family:&quot;Courier New&quot;;color:#000066">&nbsp;</span></span><b><span style="font-family:&quot;Courier New&quot;;color:#000066">null</span></b><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp; &nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">}</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
<br />
&nbsp; &nbsp; &nbsp; self.send</span><span style="font-family:&quot;Courier New&quot;;color:#F78811">(</span><span style="font-family:&quot;Courier New&quot;;color:#000066">msg, out</span><span style="font-family:&quot;Courier New&quot;;
color:#F78811">)</span><span style="font-family:&quot;Courier New&quot;;
color:#000066"><br />
&nbsp; &nbsp;<span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">}</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
&nbsp;<span class="apple-converted-space">&nbsp;</span></span><span style="font-family:&quot;Courier New&quot;;color:#F78811">}</span><span style="font-family:&quot;Courier New&quot;;color:#000066"><br />
</span><span style="font-family:&quot;Courier New&quot;;
color:#F78811">}</span><span style="font-family:&quot;Courier New&quot;;
color:#000066"><br />
<br />
</span></p>
<p>&nbsp;</p>
