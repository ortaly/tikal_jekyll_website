---
layout: post
title: Merge Update Save and filters
created: 1374043545
author: chaim.turkel
permalink: merge-update-save-and-filters
tags:
- JAVA
- Java
- Hibernate
---
<h1 align="center" style="text-align: center;">
	Merge Update Save and Filters<o:p></o:p></h1>
<div class="MsoNormal">
	&nbsp;</div>
<div class="MsoNormal">
	In sql there are three major types of actions: insert, update, delete.<o:p></o:p></div>
<div class="MsoNormal">
	Hibernate has a lot of functions that use these three actions. It is important to understand the difference between them, and when to use what.<o:p></o:p></div>
<div class="MsoNormal">
	Currently the methods that exists are (a nice summary can be found at: <a href="http://stackoverflow.com/questions/161224/what-are-the-differences-between-the-different-saving-methods-in-hibernate">http://stackoverflow.com/questions/161224/what-are-the-differences-between-the-different-saving-methods-in-hibernate</a>)<o:p></o:p></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">delete()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">persist()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">save()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">update()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">saveOrUpdate()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: 22.5pt; margin-right: 0in; margin-top: 0in; mso-list: l0 level1 lfo1; tab-stops: list .5in; text-indent: -.25in; vertical-align: baseline;">
	<!--[if !supportLists]--><span style="font-family: Symbol; font-size: 10pt;">&middot;<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="font-family: Arial, sans-serif; font-size: 10.5pt;">merge()<o:p></o:p></span></div>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; vertical-align: baseline;">
	&nbsp;</div>
<h1>
	Delete<o:p></o:p></h1>
<div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; vertical-align: baseline;">
	<span style="font-family: Arial, sans-serif; font-size: 10.5pt;">The easiest is delete. This will delete the entity from the database. The object passed to the delete method can be either transient or persistent. &nbsp;Since hibernate uses the id for the delete is does not make a difference.<o:p></o:p></span></div>
<div class="MsoNormal">
	&nbsp;</div>
<h1>
	Persist, Save<o:p></o:p></h1>
<div class="MsoNormal">
	Both of these will generate an insert into the database. The save will return the id that was generated, where persist returns void. Persist should be used unless you need the id immediately, since in the case of save an insert is run with the method, while persist is optimized and will run the insert at the latest possible time when the id is needed.<o:p></o:p></div>
<h1>
	Update<o:p></o:p></h1>
<div class="MsoNormal">
	Update is the tricky part of hibernate and has the most options. The hibernate documentation writes the following about persistent objects:<o:p></o:p></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Transactional persistent instances</span></em><span class="apple-converted-space">&nbsp;</span>(i.e. objects loaded, saved, created or queried by the<span class="apple-converted-space">&nbsp;</span><code><span style="font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 10.0pt; line-height: 107%; mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin;">Session</span></code>) can be manipulated by the application, and any changes to persistent state will be persisted when the<span class="apple-converted-space">&nbsp;</span><code><span style="font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 10.0pt; line-height: 107%; mso-fareast-font-family: Calibri; mso-fareast-theme-font: minor-latin;">Session </span></code>is<span class="apple-converted-space">&nbsp;</span><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">flushed.<o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">This means as long as the transaction and session is open, any change to a persisted object will be updated in the database when the session is flushed (usually on commit but can be called explicitly).</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">In the case of detached objects, hibernate has the methods of update and merge.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Update is the simple one. Update will persist a detached object to the database. In the case that you do not know if you need an insert or update, you can use the method saveOrUpdate. This method will check the id of the object. If there is no id an insert will be generated else an updated will be generated. </span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">In the case that you call update on an object (detached) that already has an instance in the session, hibernate will through an exception. This is since hibernate wants to let you know that two different changes have been made to the object (one in the session and the other detached). So the way hibernate lets you know is through an exception - NonUniqueObjectException.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">A simple way to solve this issue if you want to ignore previous changes and persist the latest one, is to call evict on the session and remove the previous object. Then the update will succeed.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<h1>
	Merge<o:p></o:p></h1>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Merge knows to overcome the problem of update. Though as we will see merge is very sophisticated and needs to be used with caution. The documentation of hibernate is as follows:</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: .5in; margin-right: 0in; margin-top: 0in; mso-list: l1 level1 lfo2; tab-stops: list .5in; text-align: justify; text-indent: -.25in;">
	<!--[if !supportLists]--><span style="color: #333333; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-bidi-font-size: 9.0pt; mso-fareast-font-family: &quot;Courier New&quot;;">o<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="color: #333333; font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 9.0pt;">if there is a persistent instance with the same identifier currently associated with the session, copy the state of the given object onto the persistent instance<o:p></o:p></span></div>
<div style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: .5in; margin-right: 0in; margin-top: 0in; mso-list: l1 level1 lfo2; tab-stops: list .5in; text-align: justify; text-indent: -.25in;">
	<!--[if !supportLists]--><span style="color: #333333; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-bidi-font-size: 9.0pt; mso-fareast-font-family: &quot;Courier New&quot;;">o<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="color: #333333; font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 9.0pt;">if there is no persistent instance currently associated with the session, try to load it from the database, or create a new persistent instance<o:p></o:p></span></div>
<div style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: .5in; margin-right: 0in; margin-top: 0in; mso-list: l1 level1 lfo2; tab-stops: list .5in; text-align: justify; text-indent: -.25in;">
	<!--[if !supportLists]--><span style="color: #333333; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-bidi-font-size: 9.0pt; mso-fareast-font-family: &quot;Courier New&quot;;">o<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="color: #333333; font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 9.0pt;">the persistent instance is returned<o:p></o:p></span></div>
<div style="line-height: 13.5pt; margin-bottom: .0001pt; margin-bottom: 0in; margin-left: .5in; margin-right: 0in; margin-top: 0in; mso-list: l1 level1 lfo2; tab-stops: list .5in; text-align: justify; text-indent: -.25in;">
	<!--[if !supportLists]--><span style="color: #333333; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-bidi-font-size: 9.0pt; mso-fareast-font-family: &quot;Courier New&quot;;">o<span style="font-family: 'Times New Roman'; font-size: 7pt; line-height: normal;">&nbsp;&nbsp;&nbsp; </span></span><!--[endif]--><span style="color: #333333; font-family: &quot;Verdana&quot;,&quot;sans-serif&quot;; font-size: 9.0pt;">the given instance does not become associated with the session, it remains detached<o:p></o:p></span></div>
<div class="MsoNormal">
	&nbsp;</div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Thinks you must take into consideration:</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<h2>
	<em><span style="font-family: &quot;Calibri Light&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: major-latin; mso-bidi-font-family: &quot;Times New Roman&quot;; mso-bidi-theme-font: major-bidi; mso-hansi-theme-font: major-latin;">Returned Object</span></em><em><span style="font-family: &quot;Calibri Light&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: major-latin; mso-bidi-font-family: &quot;Times New Roman&quot;; mso-bidi-theme-font: major-bidi; mso-hansi-theme-font: major-latin;"><o:p></o:p></span></em></h2>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Take care to save the result of the method, since the object in the parameter remains detached. Hibernate will update the internal object with your information but will not add it to the session since another one exits, this one will be returned to you.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<h2>
	<em><span style="font-family: &quot;Calibri Light&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: major-latin; mso-bidi-font-family: &quot;Times New Roman&quot;; mso-bidi-theme-font: major-bidi; mso-hansi-theme-font: major-latin;">Select issues</span></em><em><span style="font-family: &quot;Calibri Light&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: major-latin; mso-bidi-font-family: &quot;Times New Roman&quot;; mso-bidi-theme-font: major-bidi; mso-hansi-theme-font: major-latin;"><o:p></o:p></span></em></h2>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">The next issue is that if your object is not in the session, hibernate will generate a select statement to get it. This can be a performance hit that you did not take into consideration if all you wanted was an update. This is especially true for the case that you have fields marked as eager, or in certain cases of *ToOne (hibernate will load them also with lazy annotation &ndash; if the foreign key is not using the id [primary key]), in this case hibernate will load the whole graph.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Another problem with the select of the merge is filters. If you are using filters to load your data, and on the merge you do not have the filters open, hibernate will generate the select for the merge but without the filters. This will cause an inconsistency of data. </span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
<br />
<div class="MsoNormal">
	<em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;">Another problem with filters is the root object. Hibernate filters are activated only on connections (joins) to other objects. So if you have an object (a) that points to an object (b) that holds a collections (c&rsquo;s). Loading A where b is lazy will cause hibernate to not use the filter on b, only on c. The simple solution to this is to add a join in the hql and then the filter will be added. But in the case of merge, the original hql will not be run. A standard load will be run with the eager and the filter will not affect the object b.</span></em><em><span style="font-family: &quot;Calibri&quot;,&quot;sans-serif&quot;; font-style: normal; mso-ascii-theme-font: minor-latin; mso-bidi-font-family: Arial; mso-bidi-theme-font: minor-bidi; mso-hansi-theme-font: minor-latin;"><o:p></o:p></span></em></div>
